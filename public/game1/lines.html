<!doctype html>
<html>
    <head>
        <title>G</title>
        <meta charset="utf-8" />
    </head>
    <body>

        <script src="js/underscore.js"> </script>
        <script src="js/backbone.js"> </script>
        <script src="js/vec2.js"> </script>
        <script src="js/game.js"> </script>

        <!-- game specific -->
        <script src="bullet.js"> </script>
        <script src="player.js"> </script>

        <script>
            var TestGame = Game.extend({

                players: [],

                init: function() {
                    _.bindAll(this, 'on_new_player', 'render', 'render');
                    this.layer = this.create_layer();
                    this.pos = 0;
                    this.bind('newplayer', this.on_new_player);
                },

                on_new_player: function(controller) {
                    this.players.push(new Player(new vec2(0, 0), controller));
                },

                update: function(dt) {
                    _.each(this.players,function(p) { p.update(dt) });
                    bullets.update(dt);
                },

                render: function() {
                    // clear layer
                    var game = this;
                    game.layer.clearRect(-this.widthHalf, -this.heightHalf, 2*this.widthHalf, 2*this.heightHalf);
                    _.each(this.players, function(p) { p.render(game.layer) });
                    bullets.render(game.layer);
                }
            });
            var g = new TestGame();
            g.start();

            function Controller() {
                this.controls = {
                    left: false,
                    right: false,
                    fire: false
                };
            };

            var c = new Controller();
            local_controller(c);
            g.on_new_player(c);

            function local_controller(c) {
                window.addEventListener('keyup', function(e) {
                    if(e.keyCode == 37) { //left
                        c.controls.left = false;
                    } else if(e.keyCode == 39) { // right
                        c.controls.right= false;
                    } else if(e.keyCode == 32) {
                        c.controls.fire = false;
                    }
                });
                window.addEventListener('keydown', function(e) {
                    if(e.keyCode == 37) { //left
                        c.controls.left = true;
                    } else if(e.keyCode == 39) { // right
                        c.controls.right= true;
                    } else if(e.keyCode == 32) {
                        c.controls.fire = true;
                    }
                });
            }
        </script>
    </body>
</html>

